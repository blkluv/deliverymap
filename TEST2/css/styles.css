/* 自定義樣式 */
:root {
    /* 手機版底部安全距離 (預設值 6rem，LINE瀏覽器中會以JS調整) */
    --mobile-bottom-offset: 6rem; 
    /* 手機版店家列表寬度 (可調整此數值) */
    --mobile-panel-width: 90vw;
    /* NEW: Map filter variable */
    --map-filter-style: none;
}
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Noto Sans TC', sans-serif;
    overflow: hidden; /* 防止滾動 */
}
#map {
    width: 100%;
    height: 100%;
    background: #f0f0f0;
}
/* 網格模式下的游標 */
#map.grid-mode-active.paint-mode {
    cursor: crosshair;
}
 #map.grid-mode-active.pan-mode {
    cursor: grab;
}
#map.grid-mode-active.pan-mode:active {
    cursor: grabbing;
}
/* NEW: Map Enhancement Style */
#map .ol-layer canvas {
    transition: filter 0.5s ease-in-out, opacity 0.3s ease-in-out;
}
#map.map-enhanced .ol-layer canvas {
    filter: var(--map-filter-style);
}

/* 修正：當地圖進入網格模式時，讓地圖底圖稍微變暗，突顯網格 */
#map.grid-mode-active .ol-layer canvas {
    opacity: 0.6;
}

/* OpenLayers 彈出視窗樣式 */
.ol-popup {
    position: absolute;
    background-color: white;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #cccccc;
    bottom: 12px;
    left: -50px;
    min-width: 300px;
    max-width: 350px;
    transform: translateX(-50%);
}
.ol-popup:after, .ol-popup:before {
    top: 100%;
    border: solid transparent;
    content: " ";
    height: 0;
    width: 0;
    position: absolute;
    pointer-events: none;
}
.ol-popup:after {
    border-top-color: white;
    border-width: 10px;
    left: 50%;
    margin-left: -10px;
}
.ol-popup:before {
    border-top-color: #cccccc;
    border-width: 11px;
    left: 50%;
    margin-left: -11px;
}
.ol-popup-closer {
    text-decoration: none;
    position: absolute;
    top: 2px;
    right: 8px;
    font-size: 20px;
}
.ol-popup-closer:after {
    content: "✖";
}
/* 避免 Tailwind CSS 影響 OpenLayers 控制項 */
.ol-control button {
    background-color: rgba(255,255,255,0.8) !important;
    color: #333 !important;
    border: 1px solid #ccc !important;
}
.ol-control button:hover {
    background-color: rgba(255,255,255,1) !important;
}
/* 滾動條樣式 */
.custom-scrollbar::-webkit-scrollbar {
    width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #555;
}
#store-list-filters::-webkit-scrollbar {
    height: 9px; /* For horizontal scrollbar */
}
#store-list-filters::-webkit-scrollbar-thumb {
    background: #bbb;
    border-radius: 4px;
}
#store-list-filters::-webkit-scrollbar-track {
    background: #eee;
    border-radius: 4px;
}
/* 當前位置標記動畫 */
@keyframes pulse {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
}
.pulse-dot {
    animation: pulse 2s infinite;
}
/* 新增地點的標記樣式 */
.new-location-marker {
     width: 32px;
     height: 32px;
     background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ef4444" width="32px" height="32px"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>');
     background-size: contain;
     cursor: grab;
     transform: translate(-50%, -100%);
     z-index: 10;
}
.new-location-marker:active {
    cursor: grabbing;
}
/* NEW: Desktop Add Mode Layout */
#app-container {
    display: flex;
    width: 100%;
    height: 100%;
}
#map-container {
    flex-grow: 1;
    height: 100%;
    position: relative;
}
#add-location-modal.desktop-mode {
    position: relative;
    display: flex;
    width: 0px; /* Start with 0 width */
    max-width: 450px;
    height: 100%;
    transform: translateX(-100%);
    transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
    box-shadow: 2px 0 15px rgba(0,0,0,0.1);
    z-index: 50;
    overflow: hidden;
}
#app-container.desktop-add-mode #add-location-modal.desktop-mode {
    width: 450px;
    transform: translateX(0);
}

#desktop-center-marker {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -100%); /* Adjust to pin bottom point to center */
    z-index: 10;
    pointer-events: none; /* Make it non-interactive */
}

/* Responsive positioning for bottom elements */
#store-list-panel, #legend {
    bottom: 1rem; /* 桌面版的預設值 (Tailwind class: bottom-4) */
}
/* 在小於 768px 的螢幕上（手機版）套用較高的底部距離 */
@media (max-width: 767px) {
    #legend {
        display: none; /* 在手機版上隱藏中間的分類圖例 */
    }
    #store-list-panel {
        bottom: var(--mobile-bottom-offset);
        width: var(--mobile-panel-width);
        max-width: 400px; /* 避免在較寬的手機螢幕上過寬 */
        left: 50%;
        transform: translateX(-50%);
    }
    #add-location-modal.desktop-mode {
        display: none; /* Hide desktop version on mobile */
    }
}
@media (min-width: 768px) {
    #add-location-modal:not(.desktop-mode) {
        display: none; /* Hide mobile modal on desktop */
    }
}

/* --- BEGIN MODIFICATION: Mobile modal minimization styles with pointer-events fix --- */
#add-location-modal-mobile.minimized {
    pointer-events: none !important;
}
#add-location-modal-mobile.minimized > .bg-white {
    pointer-events: auto !important; 
    transform: translateX(calc(-100% - 2rem));
}
/* --- END MODIFICATION --- */


/* NEW: Vote button styles */
.vote-btn.voted-like svg {
    fill: #10B981; /* A brighter green */
}
.vote-btn.voted-dislike svg {
    fill: #EF4444; /* A brighter red */
}

/* 修正：網格畫布樣式 */
#grid-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* 大幅提高 z-index 確保它在所有地圖圖層之上 */
    z-index: 40; 
    pointer-events: none; /* 讓點擊事件可以穿透到下方的地圖 */
}

/* NEW: Grid toolbar styles */
#grid-toolbar {
    position: absolute;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 45; /* 確保在網格畫布之上 */
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    padding: 0.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    align-items: center;
    gap: 0.5rem;
}
.grid-tool-btn {
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: background-color 0.2s;
    border: 2px solid transparent;
}
.grid-tool-btn:hover {
    background-color: #e5e7eb; /* gray-200 */
}
.grid-tool-btn.active {
    background-color: #dbeafe; /* blue-100 */
    border-color: #3b82f6; /* blue-500 */
}
#marker-tools {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-left: 0.5rem;
    border-left: 1px solid #d1d5db; /* gray-300 */
}

/* MODIFIED: Grid Color Palette Styles */
#grid-color-palette {
    /* Repositioned from top-right to below the center toolbar */
    top: 4.5rem; 
    left: 50%;
    right: auto;
    transform: translateX(-50%);
    z-index: 45; /* 確保在網格畫布之上 */
    
    /* Changed layout from vertical to horizontal */
    flex-direction: row;
    width: auto;
    gap: 1rem;
}

#grid-color-palette > div {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
#grid-color-palette input[type="color"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 2.5rem; /* Adjusted width for horizontal layout */
    height: 2rem; /* 32px */
    background-color: transparent;
    border: 1px solid #d1d5db; /* gray-300 */
    border-radius: 0.375rem; /* rounded-md */
    cursor: pointer;
}
#grid-color-palette input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}
#grid-color-palette input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 0.25rem; /* rounded */
}

/* NEW: Styles for hiding system messages in chat */
#chat-messages.hide-system-messages .system-message {
    display: none;
}
